import{r as n,f as $,A as z,b as F,u as M,j as e,C as w,S as A,c as k}from"./index-CQeAYNtu.js";import{u as P}from"./useFetch-CpLzOSAy.js";import{A as B}from"./Add-DiHIhEfs.js";import{M as D}from"./Minus-BMzoImwz.js";import{u as q,C as J}from"./index.esm-TlQ4QrCs.js";import{u as O,C as R,o as X,c as G,a as I}from"./index.esm-CHS0dkXY.js";import{S as L}from"./Sms-DOH5A2fU.js";import"./error-B5PgSNGc.js";const T=({id:s,title:o,image:u,price:f,company:g,feature:a,setOpenPayment:m})=>{const x=n.useContext($),y=n.useContext(z),C=F(),[v,N]=n.useState(!1),c=x?.cart.find(l=>l.id===s),S=[`رنگ: ${a.backgroundColor}`,`${g}`,`قیمت: ${f.toLocaleString()}`],r=[{label:"تعداد فرش:",value:c?.count??1},{label:"مجموع سبد خرید: ",value:((c?.count??1)*f).toLocaleString()}],b=v||u,h=()=>{y?.isLogin?m(s):C("/auth/login")},d=M("(min-width: 640px)");return e.jsxs("div",{className:"w-full flex-col lg:flex-row border lg:border-0 rounded-xl border-neutral6 flex justify-between items-start gap-y-5 gap-x-10 2xl:gap-x-20 lg:h-69",children:[e.jsxs("div",{className:"h-full w-full lg:w-fit flex-1 lg:border rounded-xl border-neutral6 pr-0 sm:pr-3 p-3 flex justify-start items-start gap-x-3",children:[e.jsx("div",{className:`w-40 h-58.5 ${!b&&"bg-primary/20 rounded-md flex justify-center items-center"}`,children:b?e.jsx("img",{onError:()=>N(!0),src:u,alt:o,className:"w-full h-full object-cover"}):e.jsx("p",{className:"h4 text-primary",children:"ایرانی فرش"})}),e.jsxs("div",{className:"space-y-3.5 mt-5 flex-1",children:[e.jsx("p",{className:`${d?"h5 line-clamp-1":"text-base font-semibold line-clamp-2"}`,children:o}),S.map((l,t)=>e.jsx("div",{className:"text-sm sm:text-base lg:text-lg font-medium",children:l},t)),e.jsxs("div",{className:"w-fit py-2 px-2 rounded-xl border-neutral6 border flex items-center gap-x-5",children:[e.jsx(w,{onClick:()=>x?.changeCount?.(s.toString(),"plus"),variant:"filled",height:"h-fit",rounded:"rounded-xl",element:"button",ratio:"aspect-square",ariaLabel:"افزودن به سبد خرید",children:e.jsx(B,{className:"size-7 stroke-white"})}),e.jsx("p",{className:"h6 text-black",children:c?.count}),e.jsx(w,{onClick:()=>x?.changeCount?.(s.toString(),"minus"),variant:"filled",height:"h-fit",rounded:"rounded-xl",element:"button",ratio:"aspect-square",ariaLabel:"افزودن به سبد خرید",children:e.jsx(D,{className:"size-7 stroke-white"})})]})]})]}),e.jsx("hr",{className:"w-full border-neutral6 lg:hidden"}),e.jsxs("div",{className:"w-full lg:w-78 h-fit bg-white lg:border border-neutral6 rounded-xl p-3 space-y-5",children:[r.map((l,t)=>e.jsxs("div",{className:"flex flex-row justify-between items-center w-full",children:[e.jsx("p",{className:"font-medium",children:l.label}),e.jsx("p",{className:"font-medium",children:l.value})]},t)),e.jsx(w,{onClick:h,variant:"filled",width:"w-full",height:"h-10",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"افزودن به سبد خرید",children:"پرداخت نهایی"})]})]})},Z="/IraniFarsh/assets/redBasket-zL9gGmkd.webp",Q=()=>{const[s,o]=n.useState(!1);return n.useEffect(()=>(document.body.style.overflow=s?"hidden":"",document.body.style.touchAction=s?"none":"",()=>{document.body.style.overflow="",document.body.style.touchAction=""}),[s]),{isScrollLocked:s,setIsScrollLocked:o}},V=[{name:"address",label:"ادرس",type:"text",Icon:L},{name:"postalCode",label:"کد پستی",type:"text",Icon:L}],U=G({address:I().required("ادرس الزامی است"),postalCode:I().required("کد پستی الزامی است").matches(/^\d{10}$/,"کد پستی باید دقیقا ۱۰ رقم عدد باشد")}),ae=()=>{const s=n.useContext($),o=n.useContext(z),u=n.useContext(A),f=s?.cart.map(t=>t.id).join(","),{setIsScrollLocked:g}=Q(),[a,m]=n.useState(null),{data:x,isLoading:y,isError:C}=P("Product",`https://qaqpavkbmcujmzddezua.supabase.co/rest/v1/products?id=in.(${f})&select=*`),{control:v,handleSubmit:N,reset:c,formState:{errors:S}}=q({resolver:X(U),mode:"onSubmit"}),r=x?.data??[],b=r.find(t=>t.id===a),h=s?.cart.find(t=>t.id===a);n.useEffect(()=>{g(a!==null),a===null&&c()},[a,c,g]);const d=O({mutationFn:async t=>{const i=await fetch("https://qaqpavkbmcujmzddezua.supabase.co/rest/v1/orders",{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0"},body:JSON.stringify(t)});let p=null;const j=i.headers.get("content-type");if(j&&j.includes("application/json")&&(p=await i.json()),!i.ok)throw new Error(p?.msg||"خطا در ارسال پیام");return p},onSuccess:()=>{u?.showDialog(`${o?.userData?.first_name} ${o?.userData?.last_name} عزیز سفارشت با موفقیت ثبت شد`,"success"),a&&s?.handleRemove(a),m(null)},onError:t=>{console.log(t),u?.showDialog(t.message,"error")}}),l=t=>{if(!h)return;const i={...t,productCount:h.count,productId:h.id,userId:o?.userData?.id};d.mutate(i)};return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"w-full BodyPadding flex flex-col gap-y-6",children:[e.jsx("h1",{className:`ResponsiveFontSize ${r&&r.length>0?"":"sr-only"}`,children:"سبد خرید"}),C?e.jsx("p",{children:"error"}):y?e.jsx(k,{}):e.jsx(e.Fragment,{children:r&&r.length>0?r.map(t=>e.jsx(T,{setOpenPayment:m,...t},t.id)):e.jsxs("div",{className:"w-full flex flex-col items-center gap-y-10",children:[e.jsx("img",{className:"w-[clamp(100px,50vw,250px)] h-auto object-contain",src:Z,alt:"سبد خرید شما خالی است!"}),e.jsx("p",{className:"ResponsiveFontSize",children:"سبد خرید شما خالی است!"})]})})]}),a&&e.jsx("div",{className:"w-screen h-screen fixed top-0 left-0 bg-black/50 backdrop-blur-sm z-[999] flex justify-center items-center",onClick:()=>m(null),children:e.jsxs("form",{noValidate:!0,onSubmit:N(l),className:`w-[95%] xs:w-96 gap-y-5 bg-white rounded-2xl p-3 flex flex-col items-center justify-between ${d.isPending&&"opacity-50"}`,onClick:t=>t.stopPropagation(),children:[e.jsx("p",{className:"font-medium text-lg line-clamp-2 w-full",children:b?.title}),V.map(({name:t,label:i,type:p,Icon:j})=>e.jsx(J,{name:t,control:v,render:({field:E})=>e.jsx(R,{...E,label:i,type:p,Icon:j,error:S[t]?.message,width:"100%",Element:t==="address"?"textarea":"input",height:`${t==="address"?"150px":"56px"}`})},t)),e.jsx("div",{className:`w-full ${d.isPending&&"pointer-events-none"}`,children:e.jsx(w,{type:"submit",variant:"filled",width:"w-full",height:"h-12",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"افزودن به سبد خرید",children:d.isPending?e.jsx(k,{className:"size-7 fill-white"}):"تایید پرداخت"})})]})})]})};export{ae as default};
