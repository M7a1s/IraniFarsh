import{r as l,A as j,S,a as $,b as L,j as s,U as X,C as k,c as N,L as y,d as A,s as D,N as F}from"./index-DufmJhIQ.js";import{o as v,u as C,C as E,c as M,a as h,b as O}from"./index.esm-CR8iPuHc.js";import{u as J,C as z}from"./index.esm-DMlyLHZO.js";import{t as I}from"./error-B5PgSNGc.js";import{S as _}from"./Sms-BZkAmJ_P.js";import{L as b}from"./Lock-D8Plikv5.js";import{A as q}from"./Add-CLROsf1L.js";const R=[{name:"first_name",label:"نام",type:"text",Icon:X},{name:"last_name",label:"نام خانوادگی",type:"text",Icon:X},{name:"email",label:"ایمیل",type:"email",Icon:_},{name:"password",label:"ایجاد رمز عبور",type:"password",Icon:b},{name:"confirmPassword",label:"تکرار رمز عبور",type:"password",Icon:b}],B=M({first_name:h().required("نام الزامی است"),last_name:h().required("نام خانوادگی الزامی است"),email:h().required("ایمیل الزامی است").email("ایمیل معتبر نیست"),password:h().required("رمز عبور الزامی است").min(6,"رمز عبور باید حداقل ۶ کاراکتر باشد").matches(/[a-z]/,"رمز عبور باید شامل حداقل یک حرف کوچک باشد").matches(/[A-Z]/,"رمز عبور باید شامل حداقل یک حرف بزرگ باشد").matches(/\d/,"رمز عبور باید شامل حداقل یک عدد باشد").matches(/[@$!%*?&#]/,"رمز عبور باید شامل حداقل یک نماد باشد"),confirmPassword:h().oneOf([O("password")],"رمز عبور و تکرار آن باید یکسان باشد").required("تکرار رمز عبور الزامی است")}),T=()=>{const o=l.useContext(j),r=l.useContext(S),[,c]=$(["access_token","refresh_token"]),d=L(),{control:g,handleSubmit:p,formState:{errors:x}}=J({resolver:v(B),mode:"onSubmit"}),a=C({mutationKey:["signup"],mutationFn:async e=>{const{first_name:t,last_name:n,email:i,password:m}=e,u=await fetch("https://qaqpavkbmcujmzddezua.supabase.co/auth/v1/signup",{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0"},body:JSON.stringify({email:i,password:m,data:{first_name:t,last_name:n}})}),w=await u.json();if(!u.ok)throw new Error(w.msg||"خطا در ثبت‌نام");return w},onSuccess:e=>{const t=e.user.user_metadata;c("access_token",e.access_token,{path:"/",secure:!0}),c("refresh_token",e.refresh_token,{path:"/",secure:!0}),o?.setUserData({id:t.sub,first_name:t.first_name,last_name:t.last_name,email:t.email}),o?.setIsLogin(!0),r?.showDialog(`${t.first_name} ${t.last_name} عزیز خوش آمدی`,"info"),d("/dashboard/auth")},onError:e=>{console.log(`enError: ${e.message}
faError: ${I(e.message)}`),r?.showDialog(I(e.message),"error")}}),f=e=>{a.mutate(e)};return s.jsxs("form",{noValidate:!0,onSubmit:p(f),className:`space-y-6 w-full mt-12 ${o?.isLoading||a.isPending?"pointer-events-none opacity-50":""}`,children:[R.map(({name:e,label:t,type:n,Icon:i})=>s.jsx(z,{name:e,control:g,render:({field:m})=>s.jsx(E,{...m,label:t,type:n,Icon:i,error:x[e]?.message,width:"100%",height:"56px"})},e)),s.jsx(k,{type:"submit",variant:"filled",width:"w-full",height:"h-14",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"ثبت نام",children:o?.isLoading||a.isPending?s.jsx(N,{className:"size-7 fill-white"}):"ثبت نام"}),s.jsxs("div",{className:"Body-Regular",children:["حساب کاربری دارید؟"," ",s.jsx(y,{to:"/auth/login",className:"text-primary",children:"ورود"})," ","کنید"]})]})},G=[{name:"email",label:"ایمیل",type:"email",Icon:_},{name:"password",label:"رمز عبور",type:"password",Icon:b}],P=M({email:h().required("ایمیل الزامی است").email("ایمیل معتبر نیست"),password:h().required("رمز عبور الزامی است").min(6,"رمز عبور باید حداقل ۶ کاراکتر باشد").matches(/[a-z]/,"رمز عبور باید شامل حداقل یک حرف کوچک باشد").matches(/[A-Z]/,"رمز عبور باید شامل حداقل یک حرف بزرگ باشد").matches(/\d/,"رمز عبور باید شامل حداقل یک عدد باشد").matches(/[@$!%*?&#]/,"رمز عبور باید شامل حداقل یک نماد باشد")}),V=()=>{const o=l.useContext(S),r=l.useContext(j),[,c]=$(["access_token","refresh_token"]),d=L(),{control:g,handleSubmit:p,formState:{errors:x}}=J({resolver:v(P),mode:"onSubmit"}),a=C({mutationFn:async e=>{const{email:t,password:n}=e,i=await fetch("https://qaqpavkbmcujmzddezua.supabase.co/auth/v1/token?grant_type=password",{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0"},body:JSON.stringify({email:t,password:n})}),m=await i.json();if(!i.ok)throw new Error(m.msg||"خطا در ورود");return m},onSuccess:e=>{const t=e.user.user_metadata;c("access_token",e.access_token,{path:"/",secure:!0}),c("refresh_token",e.refresh_token,{path:"/",secure:!0}),r?.setUserData({id:t.sub,first_name:t.first_name,last_name:t.last_name,email:e.user.email}),r?.setIsLogin(!0),o?.showDialog(`${t.first_name} ${t.last_name} عزیز خوش امدی`,"info"),d("/dashboard/auth")},onError:e=>{console.log(`enError: ${e.message}
faError: ${I(e.message)}`),o?.showDialog(I(e.message),"error")}}),f=e=>{a.mutate(e)};return s.jsxs("form",{noValidate:!0,onSubmit:p(f),className:`space-y-6 w-full mt-12 ${r?.isLoading||a.isPending?"pointer-events-none opacity-50":""}`,children:[G.map(({name:e,label:t,type:n,Icon:i})=>s.jsx(z,{name:e,control:g,render:({field:m})=>s.jsx(E,{...m,label:t,type:n,Icon:i,error:x[e]?.message,width:"100%",height:"56px"})},e)),s.jsx("div",{className:"w-full text-start",children:s.jsx(y,{to:"/auth/reset-pass",className:"hover:text-primary",children:"فراموشی رمز عبور؟"})}),s.jsx(k,{type:"submit",variant:"filled",width:"w-full",height:"h-14",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"ورود",children:r?.isLoading||a.isPending?s.jsx(N,{className:"size-7 fill-white"}):"ورود"}),s.jsxs("div",{className:"Body-Regular",children:["ثبت نام نکرده اید؟همین حالا"," ",s.jsx(y,{to:"/auth/signup",className:"text-primary",children:"عضو"})," ","شوید"]})]})},U=[{name:"email",label:"ایمیل",type:"email",Icon:_}],Q=M({email:h().required("ایمیل الزامی است").email("ایمیل معتبر نیست")}),W=()=>{const o=l.useContext(S),r=l.useContext(j),{control:c,handleSubmit:d,formState:{errors:g}}=J({resolver:v(Q),mode:"onSubmit"}),p=C({mutationFn:async a=>{const{email:f}=a,e=await fetch("https://qaqpavkbmcujmzddezua.supabase.co/auth/v1/recover",{method:"POST",headers:{apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0","Content-Type":"application/json"},body:JSON.stringify({email:f,redirect_to:"https://m7a1s.github.io/IraniFarsh/auth/recovery"})}),t=await e.json();if(!e.ok)throw new Error(t.msg||"خطا در ریکاوری");return t},onSuccess:()=>{o?.showDialog("لینک بازیابی رمز عبور به ایمیل شما ارسال شد","success")},onError:a=>{console.log(`enError: ${a.message}
faError: ${I(a.message)}`),o?.showDialog(I(a.message),"error")}}),x=a=>{p.mutate(a)};return s.jsxs("form",{noValidate:!0,onSubmit:d(x),className:`space-y-6 w-full mt-12 ${r?.isLoading||p.isPending?"pointer-events-none opacity-50":""}`,children:[U.map(({name:a,label:f,type:e,Icon:t})=>s.jsx(z,{name:a,control:c,render:({field:n})=>s.jsx(E,{...n,label:f,type:e,Icon:t,error:g[a]?.message,width:"100%",height:"56px"})},a)),s.jsx("div",{className:"w-full text-start",children:s.jsx(y,{to:"/auth/login",className:"hover:text-primary",children:"ورود"})}),s.jsx(k,{type:"submit",variant:"filled",width:"w-full",height:"h-14",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"ارسال",children:r?.isLoading||p.isPending?s.jsx(N,{className:"size-7 fill-white"}):"ارسال"})]})},Y=[{name:"password",label:"ایجاد رمز عبور",type:"password",Icon:b},{name:"confirmPassword",label:"تکرار رمز عبور",type:"password",Icon:b}],H=M({password:h().required("رمز عبور الزامی است").min(6,"رمز عبور باید حداقل ۶ کاراکتر باشد").matches(/[a-z]/,"رمز عبور باید شامل حداقل یک حرف کوچک باشد").matches(/[A-Z]/,"رمز عبور باید شامل حداقل یک حرف بزرگ باشد").matches(/\d/,"رمز عبور باید شامل حداقل یک عدد باشد").matches(/[@$!%*?&#]/,"رمز عبور باید شامل حداقل یک نماد باشد"),confirmPassword:h().oneOf([O("password")],"رمز عبور و تکرار آن باید یکسان باشد").required("تکرار رمز عبور الزامی است")}),K=()=>{const o=l.useContext(S),r=l.useContext(j),[c,d]=l.useState(null),{control:g,handleSubmit:p,formState:{errors:x}}=J({resolver:v(H),mode:"onSubmit"}),a=L(),f=A(),e=C({mutationFn:async n=>{const{password:i}=n,m=await fetch("https://qaqpavkbmcujmzddezua.supabase.co/auth/v1/user",{method:"PUT",headers:{Authorization:`Bearer ${c}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0","Content-Type":"application/json"},body:JSON.stringify({password:i})}),u=await m.json();if(!m.ok)throw new Error(u.msg||"خطا در ریکاوری");return u},onSuccess:()=>{o?.showDialog("رمز عبور با موفقیت تغییر کرد","success"),a("/auth/login",{replace:!0})},onError:n=>{console.log(`enError: ${n.message}
faError: ${I(n.message)}`),o?.showDialog(I(n.message),"error")}}),t=n=>{e.mutate(n)};return l.useEffect(()=>{const n=window.location.hash.substring(1),i=new URLSearchParams(n),m=i.get("type"),u=i.get("expires_at"),w=i.get("access_token"),Z=Math.floor(Date.now()/1e3);m!=="recovery"||!u||Z>Number(u)||!w?a("/auth",{replace:!0}):d(w)},[f.pathname,a]),s.jsxs("form",{noValidate:!0,onSubmit:p(t),className:`space-y-6 w-full mt-12 ${r?.isLoading||e.isPending?"pointer-events-none opacity-50":""}`,children:[Y.map(({name:n,label:i,type:m,Icon:u})=>s.jsx(z,{name:n,control:g,render:({field:w})=>s.jsx(E,{...w,label:i,type:m,Icon:u,error:x[n]?.message,width:"100%",height:"56px"})},n)),s.jsx(k,{type:"submit",variant:"filled",width:"w-full",height:"h-14",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"تغییر رمز عبور",children:r?.isLoading||e.isPending?s.jsx(N,{className:"size-7 fill-white"}):"تغییر رمز عبور"})]})},ee=[{path:"/auth/login",title:"ورود",elem:s.jsx(V,{})},{path:"/auth/signup",title:"ثبت نام",elem:s.jsx(T,{})},{path:"/auth/reset-pass",title:"بازیابی رمز عبور",elem:s.jsx(W,{})},{path:"/auth/recovery",title:"بازیابی رمز عبور",elem:s.jsx(K,{})}],ce=()=>{const o=A(),r=l.useContext(j),c=ee.find(d=>d.path===o.pathname);return l.useEffect(()=>{c?.title&&D(c?.title)},[o.pathname,c?.title]),r?.isLogin?s.jsx(F,{to:"/dashboard/auth",replace:!0}):s.jsxs("div",{className:"w-full min-h-screen flex justify-center items-center BodyPadding relative",children:[s.jsx("div",{className:"absolute top-5 right-5 hover:bg-black/20 rounded-full",children:s.jsx(y,{to:"/",children:s.jsx(q,{className:"size-13 stroke-primary rotate-45"})})}),s.jsxs("div",{className:"flex flex-col items-center text-center flex-1 max-w-md",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("strong",{className:"block h3 text-primary",children:"ایرانی فرش"}),s.jsx("h1",{className:"h4 text-shade2",children:c?.title})]}),c?.elem]})]})};export{ce as default};
