import{r as u,A as b,S as k,a as _,b as N,j as s,U as S,C,c as v,L as y,d as $,s as O,N as Z}from"./index-BvHxx9EI.js";import{o as E,u as L,C as M,c as J,a as l,b as D}from"./index.esm-BAT2q0KY.js";import{u as z,C as A}from"./index.esm-DCBk4AhG.js";import{t as h}from"./error-B5PgSNGc.js";import{S as X}from"./Sms-CkcFgAlU.js";import{L as g}from"./Lock-DN9RnXUT.js";import{A as F}from"./Add-4rdOWKuV.js";const q=[{name:"first_name",label:"نام",type:"text",Icon:S},{name:"last_name",label:"نام خانوادگی",type:"text",Icon:S},{name:"email",label:"ایمیل",type:"email",Icon:X},{name:"password",label:"ایجاد رمز عبور",type:"password",Icon:g},{name:"confirmPassword",label:"تکرار رمز عبور",type:"password",Icon:g}],B=J({first_name:l().required("نام الزامی است"),last_name:l().required("نام خانوادگی الزامی است"),email:l().required("ایمیل الزامی است").email("ایمیل معتبر نیست"),password:l().required("رمز عبور الزامی است").min(6,"رمز عبور باید حداقل ۶ کاراکتر باشد").matches(/[a-z]/,"رمز عبور باید شامل حداقل یک حرف کوچک باشد").matches(/[A-Z]/,"رمز عبور باید شامل حداقل یک حرف بزرگ باشد").matches(/\d/,"رمز عبور باید شامل حداقل یک عدد باشد").matches(/[@$!%*?&#]/,"رمز عبور باید شامل حداقل یک نماد باشد"),confirmPassword:l().oneOf([D("password")],"رمز عبور و تکرار آن باید یکسان باشد").required("تکرار رمز عبور الزامی است")}),R=()=>{const n=u.useContext(b),o=u.useContext(k),[,a]=_(["access_token","refresh_token"]),d=N(),{control:p,handleSubmit:f,formState:{errors:I}}=z({resolver:E(B),mode:"onSubmit"}),c=L({mutationKey:["signup"],mutationFn:async e=>{const{first_name:t,last_name:m,email:i,password:r}=e,j=await fetch("https://qaqpavkbmcujmzddezua.supabase.co/auth/v1/signup",{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0"},body:JSON.stringify({email:i,password:r,data:{first_name:t,last_name:m}})}),w=await j.json();if(!j.ok)throw new Error(w.msg||"خطا در ثبت‌نام");return w},onSuccess:e=>{const t=e.user.user_metadata;a("access_token",e.access_token,{path:"/",secure:!0}),a("refresh_token",e.refresh_token,{path:"/",secure:!0}),n?.setUserData({id:t.sub,first_name:t.first_name,last_name:t.last_name,email:t.email}),n?.setIsLogin(!0),o?.showDialog(`${t.first_name} ${t.last_name} عزیز خوش آمدی`,"info"),d("/dashboard/auth")},onError:e=>{console.log(`enError: ${e.message}
faError: ${h(e.message)}`),o?.showDialog(h(e.message),"error")}}),x=e=>{c.mutate(e)};return s.jsxs("form",{noValidate:!0,onSubmit:f(x),className:`space-y-6 w-full mt-12 ${n?.isLoading||c.isPending?"pointer-events-none opacity-50":""}`,children:[q.map(({name:e,label:t,type:m,Icon:i})=>s.jsx(A,{name:e,control:p,render:({field:r})=>s.jsx(M,{...r,label:t,type:m,Icon:i,error:I[e]?.message,width:"100%",height:"56px"})},e)),s.jsx(C,{type:"submit",variant:"filled",width:"w-full",height:"h-14",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"ثبت نام",children:n?.isLoading||c.isPending?s.jsx(v,{className:"size-7 fill-white"}):"ثبت نام"}),s.jsxs("div",{className:"Body-Regular",children:["حساب کاربری دارید؟"," ",s.jsx(y,{to:"/auth/login",className:"text-primary",children:"ورود"})," ","کنید"]})]})},G=[{name:"email",label:"ایمیل",type:"email",Icon:X},{name:"password",label:"رمز عبور",type:"password",Icon:g}],T=J({email:l().required("ایمیل الزامی است").email("ایمیل معتبر نیست"),password:l().required("رمز عبور الزامی است").min(6,"رمز عبور باید حداقل ۶ کاراکتر باشد").matches(/[a-z]/,"رمز عبور باید شامل حداقل یک حرف کوچک باشد").matches(/[A-Z]/,"رمز عبور باید شامل حداقل یک حرف بزرگ باشد").matches(/\d/,"رمز عبور باید شامل حداقل یک عدد باشد").matches(/[@$!%*?&#]/,"رمز عبور باید شامل حداقل یک نماد باشد")}),U=()=>{const n=u.useContext(k),o=u.useContext(b),[,a]=_(["access_token","refresh_token"]),d=N(),{control:p,handleSubmit:f,formState:{errors:I}}=z({resolver:E(T),mode:"onSubmit"}),c=L({mutationFn:async e=>{const{email:t,password:m}=e,i=await fetch("https://qaqpavkbmcujmzddezua.supabase.co/auth/v1/token?grant_type=password",{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0"},body:JSON.stringify({email:t,password:m})}),r=await i.json();if(!i.ok)throw new Error(r.msg||"خطا در ورود");return r},onSuccess:e=>{const t=e.user.user_metadata;a("access_token",e.access_token,{path:"/",secure:!0}),a("refresh_token",e.refresh_token,{path:"/",secure:!0}),o?.setUserData({id:t.sub,first_name:t.first_name,last_name:t.last_name,email:e.user.email}),o?.setIsLogin(!0),n?.showDialog(`${t.first_name} ${t.last_name} عزیز خوش امدی`,"info"),d("/dashboard/auth")},onError:e=>{console.log(`enError: ${e.message}
faError: ${h(e.message)}`),n?.showDialog(h(e.message),"error")}}),x=e=>{c.mutate(e)};return s.jsxs("form",{noValidate:!0,onSubmit:f(x),className:`space-y-6 w-full mt-12 ${o?.isLoading||c.isPending?"pointer-events-none opacity-50":""}`,children:[G.map(({name:e,label:t,type:m,Icon:i})=>s.jsx(A,{name:e,control:p,render:({field:r})=>s.jsx(M,{...r,label:t,type:m,Icon:i,error:I[e]?.message,width:"100%",height:"56px"})},e)),s.jsx(C,{type:"submit",variant:"filled",width:"w-full",height:"h-14",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"ورود",children:o?.isLoading||c.isPending?s.jsx(v,{className:"size-7 fill-white"}):"ورود"}),s.jsxs("div",{className:"Body-Regular",children:["ثبت نام نکرده اید؟همین حالا"," ",s.jsx(y,{to:"/auth/signup",className:"text-primary",children:"عضو"})," ","شوید"]})]})},V=[{path:"/auth/login",title:"ورود",elem:s.jsx(U,{})},{path:"/auth/signup",title:"ثبت نام",elem:s.jsx(R,{})}],se=()=>{const n=$(),o=u.useContext(b),a=V.find(d=>d.path===n.pathname);return u.useEffect(()=>{a?.title&&O(a?.title)},[n.pathname,a?.title]),o?.isLogin?s.jsx(Z,{to:"/dashboard/auth",replace:!0}):s.jsxs("div",{className:"w-full min-h-screen flex justify-center items-center BodyPadding relative",children:[s.jsx("div",{className:"absolute top-5 right-5 hover:bg-black/20 rounded-full",children:s.jsx(y,{to:"/",children:s.jsx(F,{className:"size-13 stroke-primary rotate-45"})})}),s.jsxs("div",{className:"flex flex-col items-center text-center flex-1 max-w-md",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("strong",{className:"block h3 text-primary",children:"ایرانی فرش"}),s.jsx("h1",{className:"h4 text-shade2",children:a?.title})]}),a?.elem]})]})};export{se as default};
