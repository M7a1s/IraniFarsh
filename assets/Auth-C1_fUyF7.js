import{r as m,A as j,S,a as A,b as L,j as s,U as $,C as k,c as N,L as b,d as O,s as F,N as q}from"./index-B_goutT1.js";import{o as v,u as C,C as E,c as M,a as u,b as Z}from"./index.esm-BmM0eshB.js";import{u as J,C as z}from"./index.esm-C5-nESrv.js";import{t as I}from"./error-B5PgSNGc.js";import{S as _}from"./Sms-DW1RWA9R.js";import{L as y}from"./Lock-B31jAP_2.js";import{A as R}from"./Add-BzHR1_UW.js";const B=[{name:"first_name",label:"نام",type:"text",Icon:$},{name:"last_name",label:"نام خانوادگی",type:"text",Icon:$},{name:"email",label:"ایمیل",type:"email",Icon:_},{name:"password",label:"ایجاد رمز عبور",type:"password",Icon:y},{name:"confirmPassword",label:"تکرار رمز عبور",type:"password",Icon:y}],T=M({first_name:u().required("نام الزامی است"),last_name:u().required("نام خانوادگی الزامی است"),email:u().required("ایمیل الزامی است").email("ایمیل معتبر نیست"),password:u().required("رمز عبور الزامی است").min(6,"رمز عبور باید حداقل ۶ کاراکتر باشد").matches(/[a-z]/,"رمز عبور باید شامل حداقل یک حرف کوچک باشد").matches(/[A-Z]/,"رمز عبور باید شامل حداقل یک حرف بزرگ باشد").matches(/\d/,"رمز عبور باید شامل حداقل یک عدد باشد").matches(/[@$!%*?&#]/,"رمز عبور باید شامل حداقل یک نماد باشد"),confirmPassword:u().oneOf([Z("password")],"رمز عبور و تکرار آن باید یکسان باشد").required("تکرار رمز عبور الزامی است")}),G=()=>{const i=m.useContext(j),r=m.useContext(S),[,c]=A(["access_token","refresh_token"]),d=L(),{control:g,handleSubmit:h,formState:{errors:x}}=J({resolver:v(T),mode:"onSubmit"}),n=C({mutationKey:["signup"],mutationFn:async e=>{const{first_name:t,last_name:a,email:l,password:o}=e,f=await fetch("https://qaqpavkbmcujmzddezua.supabase.co/auth/v1/signup",{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0"},body:JSON.stringify({email:l,password:o,data:{first_name:t,last_name:a}})}),w=await f.json();if(!f.ok)throw new Error(w.msg||"خطا در ثبت‌نام");return w},onSuccess:e=>{const t=e.user.user_metadata;c("access_token",e.access_token,{path:"/",secure:!0}),c("refresh_token",e.refresh_token,{path:"/",secure:!0}),i?.setUserData({id:t.sub,first_name:t.first_name,last_name:t.last_name,email:t.email}),i?.setIsLogin(!0),r?.showDialog(`${t.first_name} ${t.last_name} عزیز خوش آمدی`,"info"),d("/dashboard/auth")},onError:e=>{console.log(`enError: ${e.message}
faError: ${I(e.message)}`),r?.showDialog(I(e.message),"error")}}),p=e=>{n.mutate(e)};return s.jsxs("form",{noValidate:!0,onSubmit:h(p),className:`space-y-6 w-full mt-12 ${i?.isLoading||n.isPending?"pointer-events-none opacity-50":""}`,children:[B.map(({name:e,label:t,type:a,Icon:l})=>s.jsx(z,{name:e,control:g,render:({field:o})=>s.jsx(E,{...o,label:t,type:a,Icon:l,error:x[e]?.message,width:"100%",height:"56px"})},e)),s.jsx(k,{type:"submit",variant:"filled",width:"w-full",height:"h-14",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"ثبت نام",children:i?.isLoading||n.isPending?s.jsx(N,{className:"size-7 fill-white"}):"ثبت نام"}),s.jsxs("div",{className:"Body-Regular",children:["حساب کاربری دارید؟"," ",s.jsx(b,{to:"/auth/login",className:"text-primary",children:"ورود"})," ","کنید"]})]})},P=[{name:"email",label:"ایمیل",type:"email",Icon:_},{name:"password",label:"رمز عبور",type:"password",Icon:y}],V=M({email:u().required("ایمیل الزامی است").email("ایمیل معتبر نیست"),password:u().required("رمز عبور الزامی است").min(6,"رمز عبور باید حداقل ۶ کاراکتر باشد").matches(/[a-z]/,"رمز عبور باید شامل حداقل یک حرف کوچک باشد").matches(/[A-Z]/,"رمز عبور باید شامل حداقل یک حرف بزرگ باشد").matches(/\d/,"رمز عبور باید شامل حداقل یک عدد باشد").matches(/[@$!%*?&#]/,"رمز عبور باید شامل حداقل یک نماد باشد")}),U=()=>{const i=m.useContext(S),r=m.useContext(j),[,c]=A(["access_token","refresh_token"]),d=L(),{control:g,handleSubmit:h,formState:{errors:x}}=J({resolver:v(V),mode:"onSubmit"}),n=C({mutationFn:async e=>{const{email:t,password:a}=e,l=await fetch("https://qaqpavkbmcujmzddezua.supabase.co/auth/v1/token?grant_type=password",{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0"},body:JSON.stringify({email:t,password:a})}),o=await l.json();if(!l.ok)throw new Error(o.msg||"خطا در ورود");return o},onSuccess:e=>{const t=e.user.user_metadata;c("access_token",e.access_token,{path:"/",secure:!0}),c("refresh_token",e.refresh_token,{path:"/",secure:!0}),r?.setUserData({id:t.sub,first_name:t.first_name,last_name:t.last_name,email:e.user.email}),r?.setIsLogin(!0),i?.showDialog(`${t.first_name} ${t.last_name} عزیز خوش امدی`,"info"),d("/dashboard/auth")},onError:e=>{console.log(`enError: ${e.message}
faError: ${I(e.message)}`),i?.showDialog(I(e.message),"error")}}),p=e=>{n.mutate(e)};return s.jsxs("form",{noValidate:!0,onSubmit:h(p),className:`space-y-6 w-full mt-12 ${r?.isLoading||n.isPending?"pointer-events-none opacity-50":""}`,children:[P.map(({name:e,label:t,type:a,Icon:l})=>s.jsx(z,{name:e,control:g,render:({field:o})=>s.jsx(E,{...o,label:t,type:a,Icon:l,error:x[e]?.message,width:"100%",height:"56px"})},e)),s.jsx("div",{className:"w-full text-start",children:s.jsx(b,{to:"/auth/reset-pass",className:"hover:text-primary",children:"فراموشی رمز عبور؟"})}),s.jsx(k,{type:"submit",variant:"filled",width:"w-full",height:"h-14",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"ورود",children:r?.isLoading||n.isPending?s.jsx(N,{className:"size-7 fill-white"}):"ورود"}),s.jsxs("div",{className:"Body-Regular",children:["ثبت نام نکرده اید؟همین حالا"," ",s.jsx(b,{to:"/auth/signup",className:"text-primary",children:"عضو"})," ","شوید"]})]})},Q=[{name:"email",label:"ایمیل",type:"email",Icon:_}],W=M({email:u().required("ایمیل الزامی است").email("ایمیل معتبر نیست")}),Y=()=>{const i=m.useContext(S),r=m.useContext(j),{control:c,handleSubmit:d,formState:{errors:g}}=J({resolver:v(W),mode:"onSubmit"}),h=C({mutationFn:async n=>{const{email:p}=n,e=await fetch("https://qaqpavkbmcujmzddezua.supabase.co/auth/v1/recover",{method:"POST",headers:{apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0","Content-Type":"application/json"},body:JSON.stringify({email:p,redirect_to:"https://m7a1s.github.io/IraniFarsh/#"})}),t=await e.json();if(!e.ok)throw new Error(t.msg||"خطا در ریکاوری");return t},onSuccess:()=>{i?.showDialog("لینک بازیابی رمز عبور به ایمیل شما ارسال شد","success")},onError:n=>{console.log(`enError: ${n.message}
faError: ${I(n.message)}`),i?.showDialog(I(n.message),"error")}}),x=n=>{h.mutate(n)};return s.jsxs("form",{noValidate:!0,onSubmit:d(x),className:`space-y-6 w-full mt-12 ${r?.isLoading||h.isPending?"pointer-events-none opacity-50":""}`,children:[Q.map(({name:n,label:p,type:e,Icon:t})=>s.jsx(z,{name:n,control:c,render:({field:a})=>s.jsx(E,{...a,label:p,type:e,Icon:t,error:g[n]?.message,width:"100%",height:"56px"})},n)),s.jsx("div",{className:"w-full text-start",children:s.jsx(b,{to:"/auth/login",className:"hover:text-primary",children:"ورود"})}),s.jsx(k,{type:"submit",variant:"filled",width:"w-full",height:"h-14",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"ارسال",children:r?.isLoading||h.isPending?s.jsx(N,{className:"size-7 fill-white"}):"ارسال"})]})},H=[{name:"password",label:"ایجاد رمز عبور",type:"password",Icon:y},{name:"confirmPassword",label:"تکرار رمز عبور",type:"password",Icon:y}],K=M({password:u().required("رمز عبور الزامی است").min(6,"رمز عبور باید حداقل ۶ کاراکتر باشد").matches(/[a-z]/,"رمز عبور باید شامل حداقل یک حرف کوچک باشد").matches(/[A-Z]/,"رمز عبور باید شامل حداقل یک حرف بزرگ باشد").matches(/\d/,"رمز عبور باید شامل حداقل یک عدد باشد").matches(/[@$!%*?&#]/,"رمز عبور باید شامل حداقل یک نماد باشد"),confirmPassword:u().oneOf([Z("password")],"رمز عبور و تکرار آن باید یکسان باشد").required("تکرار رمز عبور الزامی است")}),ee=()=>{const i=m.useContext(S),r=m.useContext(j),[c,d]=m.useState(null),{control:g,handleSubmit:h,formState:{errors:x}}=J({resolver:v(K),mode:"onSubmit"}),n=L(),p=O(),e=C({mutationFn:async a=>{const{password:l}=a,o=await fetch("https://qaqpavkbmcujmzddezua.supabase.co/auth/v1/user",{method:"PUT",headers:{Authorization:`Bearer ${c}`,apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcXBhdmtibWN1am16ZGRlenVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1ODQwMTAsImV4cCI6MjA2NzE2MDAxMH0.RDrMXyFXS3Ey1dnqLUkQMdGXLvIijS0Wrfs3Z1Gl8l0","Content-Type":"application/json"},body:JSON.stringify({password:l})}),f=await o.json();if(!o.ok)throw new Error(f.msg||"خطا در ریکاوری");return f},onSuccess:()=>{i?.showDialog("رمز عبور با موفقیت تغییر کرد","success"),n("/auth/login",{replace:!0})},onError:a=>{console.log(`enError: ${a.message}
faError: ${I(a.message)}`),i?.showDialog(I(a.message),"error")}}),t=a=>{e.mutate(a)};return m.useEffect(()=>{let a=window.location.hash.substring(1);const l=a.lastIndexOf("?");l!==-1&&(a=a.substring(l+1));const o=new URLSearchParams(a),f=o.get("type"),w=o.get("expires_at"),X=o.get("access_token"),D=Math.floor(Date.now()/1e3);f!=="recovery"||!w||D>Number(w)||!X?n("/auth",{replace:!0}):d(X)},[p.pathname,n]),s.jsxs("form",{noValidate:!0,onSubmit:h(t),className:`space-y-6 w-full mt-12 ${r?.isLoading||e.isPending?"pointer-events-none opacity-50":""}`,children:[H.map(({name:a,label:l,type:o,Icon:f})=>s.jsx(z,{name:a,control:g,render:({field:w})=>s.jsx(E,{...w,label:l,type:o,Icon:f,error:x[a]?.message,width:"100%",height:"56px"})},a)),s.jsx(k,{type:"submit",variant:"filled",width:"w-full",height:"h-14",rounded:"rounded-xl",element:"button",ratio:"aspect-auto",ariaLabel:"تغییر رمز عبور",children:r?.isLoading||e.isPending?s.jsx(N,{className:"size-7 fill-white"}):"تغییر رمز عبور"})]})},se=[{path:"/auth/login",title:"ورود",elem:s.jsx(U,{})},{path:"/auth/signup",title:"ثبت نام",elem:s.jsx(G,{})},{path:"/auth/reset-pass",title:"بازیابی رمز عبور",elem:s.jsx(Y,{})},{path:"/auth/recovery",title:"بازیابی رمز عبور",elem:s.jsx(ee,{})}],le=()=>{const i=O(),r=m.useContext(j),c=se.find(d=>d.path===i.pathname);return m.useEffect(()=>{c?.title&&F(c?.title)},[i.pathname,c?.title]),r?.isLogin?s.jsx(q,{to:"/dashboard/auth",replace:!0}):s.jsxs("div",{className:"w-full min-h-screen flex justify-center items-center BodyPadding relative",children:[s.jsx("div",{className:"absolute top-5 right-5 hover:bg-black/20 rounded-full",children:s.jsx(b,{to:"/",children:s.jsx(R,{className:"size-13 stroke-primary rotate-45"})})}),s.jsxs("div",{className:"flex flex-col items-center text-center flex-1 max-w-md",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("strong",{className:"block h3 text-primary",children:"ایرانی فرش"}),s.jsx("h1",{className:"h4 text-shade2",children:c?.title})]}),c?.elem]})]})};export{le as default};
